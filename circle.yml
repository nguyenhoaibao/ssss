machine:
  post:
    - nvm install 7 && nvm use 7 && nvm alias default 7
    - ./scripts/build_env_vars.sh
database:
  override:
    - mysql -u $MYSQL_USERNAME -e "CREATE DATABASE IF NOT EXISTS $MYSQL_DBNAME CHARACTER SET $MYSQL_CHARSET COLLATE $MYSQL_COLLATE;"
    - npm run db:migrate
test:
  override:
    - npm run lint
    - npm run test
deployment:
  staging:
    branch: develop
    codedeploy:
      spout-deployment:
        application_root: /
        revision_location:
          revision_type: S3
          s3_location:
            bucket: spout-deployment
            key_pattern: apps/spout-api-{SHORT_COMMIT}-{BUILD_NUM}
        region: ap-southeast-1
        deployment_group: api
        deployment_config: CodeDeployDefault.OneAtATime
